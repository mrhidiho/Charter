# On-Network AI System for Secure Repo, Jira, and Log Parsing

This document describes the architecture, network security, and open-source model options for deploying an **on-premises AI system** that parses repositories, Jira tickets, logs, and other company resources to generate documentation, assist with troubleshooting, and support maintenance predictions.  
The design ensures:
- **No data leaves the secure environment** (air-gapped, zero egress).
- **No ability to write or change** staging or production environments.
- **All access is read-only** with strong identity and network controls.

---

## 1. High-Level Architecture

**Zones & data flow:**

1. **Source Zone (read-only)**
   - GitHub Enterprise/Bitbucket, Confluence, Jira Data Center/Server, CI/CD logs, OpenSearch/ELK, Prometheus metrics.
   - Access through read-only tokens or service accounts.

2. **Ingest & Normalize**
   - Airflow/Prefect pipelines pull data on schedules.
   - Output stored in MinIO (S3-compatible object store) and indexed into OpenSearch.

3. **Embedding & Indexing**
   - Text chunks embedded with **BGE-large-en v1.5** or **all-MiniLM-L6-v2**.
   - Stored in **Qdrant** or **Milvus** vector database.

4. **Model Serving**
   - **vLLM** or **Hugging Face TGI** serving **Llama 3.1** or **Mistral** open models.
   - Internal-only API, **no internet access**.

5. **RAG API Layer**
   - FastAPI service that retrieves top-k chunks from vector DB + OpenSearch.
   - Formats context and calls LLM.
   - Returns answers with citations to source artifacts.

6. **Optional ML Predictions**
   - Features built from logs, incidents, deploy cadence, error rates.
   - Trained/stored via **Feast** + **MLflow**, surfaced in OpenSearch dashboards.

---

## 2. Network Security & Controls

- **Segmentation**
  - Separate namespaces: `ingest`, `search`, `vector`, `llm`, `api`.
  - Default-deny with Kubernetes `NetworkPolicies`.

- **No egress**
  - Block all outbound internet traffic at firewall and cluster level.
  - DNS resolves internal zones only.

- **Identity & Access**
  - Read-only tokens for Git, Jira, Confluence.
  - No kube credentials to stage/prod clusters.
  - Secrets stored in Vault; rotated automatically.

- **Pod Security**
  - Gatekeeper/Kyverno policies:
    - Deny `hostNetwork`, `hostPID`, privileged pods.
    - Enforce `readOnlyRootFilesystem`.
    - Drop dangerous Linux capabilities (`NET_RAW`, `NET_ADMIN`).
    - Allowlist container registries.

- **Audit & Governance**
  - All data chunks stamped with owner and retention policy.
  - Every AI answer includes source doc IDs.
  - Prompts/answers logged (PII-scrubbed) for audit.

---

## 3. Components

- **Serving:** vLLM or Hugging Face TGI  
- **Vector DB:** Qdrant or Milvus  
- **Search/Logs:** OpenSearch + Dashboards  
- **Embeddings:** BGE-large-en v1.5 or all-MiniLM-L6-v2  
- **ETL:** Airflow + connectors for Jira/Confluence/Git/logs  
- **Optional ML:** Feast (feature store), MLflow (model registry)

---

## 4. Deployment Profiles

**Starter (POC)**
- 1× A100/H100 or 2× L40S GPU
- Llama 3.1-8B Instruct or Mistral-7B
- Single-node Qdrant + OpenSearch

**Team-Scale**
- 2–4× GPU nodes (H100/L40S) with tensor parallel
- Llama 3.1-70B or Mixtral 8×22B
- HA Qdrant/Milvus + multi-node OpenSearch

---

## 5. Use Cases

- **Documentation:** nightly ingestion of repos/Jira/Confluence, RAG output as Markdown with source links.
- **Log Parsing:** error pattern detection, OpenSearch queries generated by RAG for drill-down.
- **Maintenance Prediction:** models trained on incident history and deploy cadence to forecast high-risk services.

---

## 6. Security Runbook

- **Change control:** models/weights as immutable artifacts; CAB approval for updates.
- **Secrets:** short-lived Vault tokens only.
- **No egress proofs:** firewall denies 0.0.0.0/0; logs shipped to SIEM.
- **Read-only proofs:** API scopes limited to GET; Gatekeeper forbids outbound to prod CIDRs.

---

## 7. Model Choices

- **Llama 3.1 Instruct (8B/70B):** strong generalist, community license.  
- **Mistral/Mixtral open weights:** Apache-2.0 license, strong for code/log reasoning.  
- **Embeddings:** BGE-large-en v1.5 (quality) or all-MiniLM-L6-v2 (speed/CPU).

---

## 8. Deployment Steps (Kubernetes)

1. Create namespaces (`ingest`, `search`, `vector`, `llm`, `api`).  
2. Install OpenSearch and Qdrant (mirrored charts).  
3. Deploy vLLM with mounted model weights.  
4. Deploy RAG API (FastAPI).  
5. Deploy API Gateway (NGINX reverse proxy).  
6. Apply Gatekeeper constraints and NetworkPolicies.

---

## 9. Quick Reference (Charter-style)

- **LLM:** Llama 3.1-70B (large) or Mistral open weights.  
- **Vector:** Qdrant + BGE embeddings.  
- **Logs:** OpenSearch.  
- **Security:** air-gapped, default-deny egress, Gatekeeper policies, read-only API scopes, Vault.  

---
